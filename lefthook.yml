colors: true

pre-commit:
  parallel: true
  commands:
    lint:
      run: |
        echo "ğŸ” Linting and fixing code..."
        pnpm run lint:fix
        if ! git diff --quiet; then
          echo " Lint fixes were applied. Please review, stage the lint fixes (for example, git add <files>), and re-commit."
          exit 1
        fi
      skip: [merge, rebase]

    typecheck:
      run: |
        echo "ğŸ” Type checking..."
        pnpm run check-types
      skip: [merge, rebase]

    test:
      run: |
        echo "ğŸ§ª Running unit tests..."
        pnpm run test:unit
      skip: [merge, rebase]

commit-msg:
  commands:
    commitlint:
      run: |
        echo "ğŸ“ Validating commit message..."
        bunx commitlint --edit {1}

post-merge:
  commands:
    update-deps:
      run: |
        echo "ğŸ“¦ Checking dependencies..."
        if git diff --name-only ORIG_HEAD HEAD 2>/dev/null | grep -E 'pnpm-lock\.yaml|package\.json'; then
          echo "ğŸ“¦ Updating dependencies..."
          pnpm install
        fi

post-checkout:
  commands:
    setup:
      run: |
        echo "ğŸ§¹ Preparing workspace..."
        if [ "{3}" = "1" ] && git diff --name-only {1} {2} 2>/dev/null | grep -E 'pnpm-lock\.yaml|package\.json'; then
          echo "ğŸ“¦ Updating dependencies for new branch..."
          pnpm install
        fi
